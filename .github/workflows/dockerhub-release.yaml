name: Retag RC Docker image

on:
  pull_request_review:
    types: [submitted]

jobs:
  release:
    if: >
      github.event.review.state == 'approved' && (github.event.pull_request.base.ref == 'master' || github.event.pull_request.base.ref == 'main')
    # TODO: Pin reusable workflow to a version tag once v1 is released
    uses: reportportal/.github/.github/workflows/dockerhub-release.yaml@main
    secrets:
      AWS_ROLE_ARN: ${{ secrets.AWS_ROLE_ARN }}
      REGESTRY_USERNAME: ${{ secrets.REGESTRY_USERNAME }}
      REGESTRY_PASSWORD: ${{ secrets.REGESTRY_PASSWORD }}
    with:
      aws-region: ${{ vars.AWS_REGION }}
      ecr-repository: ${{ vars.ECR_REPOSITORY || 'service-ui' }}
      target-registry: ${{ vars.TARGET_REGISTRY || 'docker.io' }}
      target-repository: ${{ vars.TARGET_REPOSITORY || 'reportportal/service-ui' }}
      platforms: ${{ vars.BUILD_PLATFORMS }}
      release-mode: rc
